programs:
  - name: bpf-jit
    metrics:
      counters:
        # Technically this is a gauge, but ebpf_exporter only knows counters
        - name: bpf_jit_pages_currently_allocated
          help: Current number of pages allocated for bpf jit
          map: current
          labels:
            # ebpf_exporter doesn't support metrics without labels
            - name: empty
              size: 4
              decoders:
                - name: uint
                - name: static_map
                  static_map:
                    0: ""
    kprobes:
      # Sometimes bpf_jit_charge_modmem / bpf_jit_uncharge_modmem get elided,
      # so we're tracing the outer entrypoints instead.
      # It's common to see calls to bpf_jit_binary_free not being traced too.
      bpf_jit_binary_alloc: trace_change
    kaddrs:
      - bpf_jit_current
